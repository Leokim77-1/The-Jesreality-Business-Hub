<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Dashboard</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
  body { background: #121212; color: #fff; }

  header { background: #1f1f1f; padding: 20px; text-align: center; box-shadow: 0 3px 6px rgba(0,0,0,0.4); position: sticky; top: 0; z-index: 10; }
  header h1 { font-size: 1.8em; }

  .container { display: flex; height: calc(100vh - 80px); transition: all 0.3s; }

  /* Sidebar */
  .sidebar { width: 250px; background: #1f1f1f; overflow-y: auto; border-right: 1px solid #333; transition: all 0.3s; }
  .sidebar h2 { padding: 15px; font-size: 1.1em; background: #2c2c2c; text-align: center; }
  .product-item { padding: 10px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
  .product-item:hover { background: #333; }
  .product-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; }
  .product-item.active { background: #4e73df; }
  #newProductBtn { width:90%; margin:15px auto; display:block; padding:10px; background:#4e73df; color:#fff; border:none; border-radius:5px; cursor:pointer; }

  /* Collapsed Sidebar */
  .sidebar.collapsed { width: 0; overflow: hidden; }
  .container.collapsed .main { flex: 1; }

  /* Main panel */
  .main { flex: 1; padding: 20px; overflow-y: auto; transition: all 0.3s; }
  .main h2 { margin-bottom: 15px; display:flex; justify-content: space-between; align-items: center; }
  .toggle-btn { background:#4e73df; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; }
  .main form { display: flex; flex-direction: column; gap: 10px; background: #1f1f1f; padding: 20px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.4); max-width: 500px; }
  .main input, .main textarea, .main button { padding: 10px; border-radius: 5px; border: none; font-size: 1em; }
  .main input, .main textarea { background: #2c2c2c; color: #fff; }
  .main button { background: #4e73df; color: #fff; cursor: pointer; transition: 0.2s; }
  .main button:hover { background: #2e59d9; }

  /* Modal */
  .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 20; }
  .modal { background: #1f1f1f; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 10px; }
  .modal input, .modal textarea, .modal button { width: 100%; padding: 10px; border-radius: 5px; border: none; }
  .modal input, .modal textarea { background: #2c2c2c; color: #fff; }
  .modal button { background: #4e73df; color: #fff; cursor: pointer; transition: 0.2s; }
  .modal button:hover { background: #2e59d9; }
  .modal button.cancel { background: #d9534f; }

  @media (max-width: 768px) {
    .container { flex-direction: column; }
    .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid #333; }
    .main { width: 100%; }
  }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<header>
  <h1>Product Dashboard</h1>
</header>

<div class="container" id="container">
  <div class="sidebar" id="sidebar">
    <h2>Products</h2>
    <div id="productList"></div>
    <button id="newProductBtn">+ New Product</button>
  </div>

  <div class="main">
    <h2>Edit Product <button class="toggle-btn" id="toggleSidebar">Toggle Sidebar</button></h2>
    <form id="editForm">
      <input type="text" id="editName" placeholder="Product Name" required>
      <textarea id="editDescription" rows="3" placeholder="Product Description" required></textarea>
      <input type="number" id="editPrice" placeholder="Price" required>
      <img id="editImagePreview" src="" alt="" style="width:150px; height:150px; object-fit:cover; border-radius:10px; margin-bottom:10px;">
      <input type="file" id="editImage" accept="image/*">
      <button type="submit">Save Changes</button>
      <button type="button" id="deleteProductBtn" style="background:#d9534f; margin-top:5px;">Delete Product</button>
    </form>
  </div>
</div>

<!-- Modal for new product -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h2>New Product</h2>
    <input type="text" id="newName" placeholder="Product Name" required>
    <textarea id="newDescription" rows="3" placeholder="Product Description" required></textarea>
    <input type="number" id="newPrice" placeholder="Price" required>
    <input type="file" id="newImage" accept="image/*" required>
    <button id="addProductBtn">Add Product</button>
    <button id="closeModal" class="cancel">Cancel</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCU4xwkZr3_g2SIVbYBnoCIS6CO-YTa-KM",
  authDomain: "bottst-e3e6b.firebaseapp.com",
  databaseURL: "https://bottst-e3e6b-default-rtdb.firebaseio.com/",
  projectId: "bottst-e3e6b",
  storageBucket: "bottst-e3e6b.firebasestorage.app",
  messagingSenderId: "621123930271",
  appId: "1:621123930271:web:2c027ddd50195bb46cfaaa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const IMGBB_API_KEY = "2d4b8d83cfbc97c237f45fe4bfa35dd0";

let productsData = [];
let selectedKey = null;

// Elements
const productListDiv = document.getElementById('productList');
const editForm = document.getElementById('editForm');
const editName = document.getElementById('editName');
const editDescription = document.getElementById('editDescription');
const editPrice = document.getElementById('editPrice');
const editImage = document.getElementById('editImage');
const editImagePreview = document.getElementById('editImagePreview');
const deleteProductBtn = document.getElementById('deleteProductBtn');

const modalBg = document.getElementById('modalBg');
const newProductBtn = document.getElementById('newProductBtn');
const closeModal = document.getElementById('closeModal');
const addProductBtn = document.getElementById('addProductBtn');
const newName = document.getElementById('newName');
const newDescription = document.getElementById('newDescription');
const newPrice = document.getElementById('newPrice');
const newImage = document.getElementById('newImage');

const sidebar = document.getElementById('sidebar');
const container = document.getElementById('container');
const toggleSidebarBtn = document.getElementById('toggleSidebar');

// Fetch products
db.ref('products').on('value', snapshot => {
  productsData = [];
  snapshot.forEach(child => {
    productsData.push({ key: child.key, ...child.val() });
  });
  renderProductList();
});

// Render sidebar product list
function renderProductList() {
  productListDiv.innerHTML = '';
  productsData.forEach(p => {
    const div = document.createElement('div');
    div.className = 'product-item' + (selectedKey === p.key ? ' active' : '');
    div.innerHTML = `<img src="${p.imageURL}"><span>${p.name}</span>`;
    div.addEventListener('click', () => selectProduct(p.key));
    productListDiv.appendChild(div);
  });
}

// Select product to edit
function selectProduct(key) {
  selectedKey = key;
  const product = productsData.find(p => p.key === key);
  editName.value = product.name;
  editDescription.value = product.description;
  editPrice.value = product.price;
  editImagePreview.src = product.imageURL;
  renderProductList();
}

// Update product
editForm.addEventListener('submit', async e => {
  e.preventDefault();
  if (!selectedKey) return;

  let imageURL = editImagePreview.src;

  if (editImage.files[0]) {
    const reader = new FileReader();
    reader.onloadend = async () => {
      const base64 = reader.result.replace(/^data:image\/[a-z]+;base64,/, '');
      const formData = new FormData();
      formData.append('key', IMGBB_API_KEY);
      formData.append('image', base64);

      const response = await fetch('https://api.imgbb.com/1/upload', { method: 'POST', body: formData });
      const data = await response.json();
      imageURL = data.data.url;

      saveEdit(imageURL);
    };
    reader.readAsDataURL(editImage.files[0]);
  } else {
    saveEdit(imageURL);
  }
});

function saveEdit(imageURL) {
  db.ref('products/' + selectedKey).update({
    name: editName.value,
    description: editDescription.value,
    price: editPrice.value,
    imageURL
  });
}

// Delete product
deleteProductBtn.addEventListener('click', () => {
  if (!selectedKey) return;
  db.ref('products/' + selectedKey).remove();
  selectedKey = null;
  editForm.reset();
  editImagePreview.src = '';
});

// Modal open/close
newProductBtn.addEventListener('click', () => modalBg.style.display = 'flex');
closeModal.addEventListener('click', () => modalBg.style.display = 'none');

// Add new product
addProductBtn.addEventListener('click', async () => {
  if (!newName.value || !newDescription.value || !newPrice.value || !newImage.files[0]) return alert('All fields are required');
  
  const imageFile = newImage.files[0];
  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64 = reader.result.replace(/^data:image\/[a-z]+;base64,/, '');
    const formData = new FormData();
    formData.append('key', IMGBB_API_KEY);
    formData.append('image', base64);

    const response = await fetch('https://api.imgbb.com/1/upload', { method: 'POST', body: formData });
    const data = await response.json();
    const imageURL = data.data.url;

    db.ref('products').push({
      name: newName.value,
      description: newDescription.value,
      price: newPrice.value,
      imageURL
    });

    newName.value = '';
    newDescription.value = '';
    newPrice.value = '';
    newImage.value = '';
    modalBg.style.display = 'none';
  };
  reader.readAsDataURL(imageFile);
});

// Sidebar toggle
toggleSidebarBtn.addEventListener('click', () => {
  sidebar.classList.toggle('collapsed');
  container.classList.toggle('collapsed');
});
</script>
</body>
</html>
